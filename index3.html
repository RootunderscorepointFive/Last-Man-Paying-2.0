<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last Man Paying 2.0 - Welcome to the Danger Zone</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        
        .hero-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            padding: 20px;
        }
        
        .floating-emojis {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .emoji {
            position: absolute;
            font-size: 2rem;
            animation: float 6s ease-in-out infinite;
            opacity: 0.7;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            50% { transform: translateY(-10px) rotate(-5deg); }
            75% { transform: translateY(-15px) rotate(3deg); }
        }
        
        .hero-title {
            font-size: 4rem;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            animation: slideInDown 1s ease-out;
        }
        
        .hero-subtitle {
            font-size: 1.5rem;
            color: #f8f9fa;
            margin-bottom: 30px;
            animation: slideInUp 1s ease-out 0.3s both;
        }
        
        .danger-zone {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 40px;
            animation: pulse 2s infinite, slideInUp 1s ease-out 0.6s both;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }
        
        .cta-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            animation: slideInUp 1s ease-out 0.9s both;
        }
        
        .cta-btn {
            background: white;
            color: #37003c;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .cta-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            background: #37003c;
            color: white;
        }
        
        .cta-btn.secondary {
            background: transparent;
            color: white;
            border: 2px solid white;
        }
        
        .cta-btn.secondary:hover {
            background: white;
            color: #37003c;
        }
        
        .stats-preview {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
            animation: slideInUp 1s ease-out 1.2s both;
        }
        
        .stat-bubble {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-bubble:hover {
            transform: scale(1.05);
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #37003c;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .features-section {
            background: white;
            padding: 80px 20px;
            text-align: center;
        }
        
        .features-title {
            font-size: 2.5rem;
            color: #37003c;
            margin-bottom: 50px;
            animation: fadeInUp 1s ease-out;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #e8ecff 100%);
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeInUp 1s ease-out;
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        .feature-title {
            font-size: 1.5rem;
            color: #37003c;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .feature-description {
            color: #666;
            line-height: 1.6;
        }
        
        .rules-teaser {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }
        
        .rules-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            animation: fadeInUp 1s ease-out;
        }
        
        .rules-subtitle {
            font-size: 1.2rem;
            margin-bottom: 40px;
            opacity: 0.9;
            animation: fadeInUp 1s ease-out 0.3s both;
        }
        
        .rules-highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto 40px;
        }
        
        .rule-highlight {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            animation: fadeInUp 1s ease-out;
        }
        
        .rule-highlight h4 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .footer {
            background: #37003c;
            color: white;
            padding: 40px 20px;
            text-align: center;
        }
        
        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .footer h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        
        .footer p {
            opacity: 0.8;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .social-link {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px;
            border-radius: 50%;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }
        
        .social-link:hover {
            background: white;
            color: #37003c;
            transform: scale(1.1);
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .scroll-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            animation: bounce 2s infinite;
            font-size: 2rem;
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.2rem;
            }
            
            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .stats-preview {
                position: relative;
                bottom: auto;
                margin-top: 40px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .rules-highlights {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <div class="floating-emojis" id="floating-emojis">
            <!-- Emojis will be generated by JavaScript -->
        </div>
        
        <h1 class="hero-title">🏆 Last Man Paying 2.0</h1>
        <p class="hero-subtitle">Where Fantasy Football Dreams Come to Die</p>
        
        <div class="danger-zone">
            ⚠️ ENTERING THE RELEGATION ZONE ⚠️
        </div>
        
        <div class="cta-buttons">
            <a href="#" class="cta-btn" onclick="enterLeague()">🚀 Enter the League</a>
            <a href="#features" class="cta-btn secondary">📊 See Features</a>
        </div>
        
        <div class="stats-preview">
            <div class="stat-bubble">
                <div class="stat-number">R100</div>
                <div class="stat-label">Weekly Fine</div>
            </div>
            <div class="stat-bubble">
                <div class="stat-number">16</div>
                <div class="stat-label">Brave Souls</div>
            </div>
            <div class="stat-bubble">
                <div class="stat-number">38</div>
                <div class="stat-label">Weeks of Pain</div>
            </div>
        </div>
        
        <div class="scroll-indicator">⬇️</div>
    </div>
    
    <div class="features-section" id="features">
        <h2 class="features-title">🔥 What Awaits You in the Danger Zone</h2>
        
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">💸</div>
                <h3 class="feature-title">Weekly Penalties</h3>
                <p class="feature-description">Bottom 3 teams each week pay R100. No mercy, no excuses. Your wallet will feel the pain of poor captaincy choices.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">📊</div>
                <h3 class="feature-title">Live Tracking</h3>
                <p class="feature-description">Watch in real-time as your rank plummets and your fines accumulate. Beautiful charts showing your descent into fantasy football hell.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">🏆</div>
                <h3 class="feature-title">Champions League Final</h3>
                <p class="feature-description">All fines go towards an epic Airbnb for the Champions League final. Your suffering funds the ultimate football viewing party.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">⚡</div>
                <h3 class="feature-title">Real FPL Data</h3>
                <p class="feature-description">Connected directly to Fantasy Premier League API. Your shame is calculated with mathematical precision using real scores.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">🎯</div>
                <h3 class="feature-title">Relegation Zone</h3>
                <p class="feature-description">Special highlighting for the bottom three. Pulsing red animations ensure everyone knows who's in the danger zone.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">📱</div>
                <h3 class="feature-title">Mobile Friendly</h3>
                <p class="feature-description">Check your shameful position anywhere, anytime. Responsive design means your embarrassment is always accessible.</p>
            </div>
        </div>
    </div>
    
    <div class="rules-teaser">
        <h2 class="rules-title">⚖️ The Sacred Rules</h2>
        <p class="rules-subtitle">Agreed upon August 10th, 2025 - No mercy until May 30, 2026</p>
        
        <div class="rules-highlights">
            <div class="rule-highlight">
                <h4>💰 R250 Entry Fee</h4>
                <p>Your ticket to months of potential humiliation</p>
            </div>
            <div class="rule-highlight">
                <h4>🥇 Winner Buys Booze</h4>
                <p>Champions provide the celebration drinks</p>
            </div>
            <div class="rule-highlight">
                <h4>🥄 Loser Becomes Squire</h4>
                <p>Last place serves the winner like royalty</p>
            </div>
            <div class="rule-highlight">
                <h4>🚪 Early Exit Penalty</h4>
                <p>Leave after GW18? Pay 250% of your fines</p>
            </div>
        </div>
        
        <a href="#" class="cta-btn" onclick="showRules()">📋 Read Full Rules</a>
    </div>
    
    <div class="footer">
        <div class="footer-content">
            <h3>🎮 Ready to Risk It All?</h3>
            <p>Join the most ruthless Fantasy Premier League experience ever created. Where every gameweek could cost you money, and every transfer could be your last mistake.</p>
            
            <div class="social-links">
                <a href="#" class="social-link">⚽</a>
                <a href="#" class="social-link">📊</a>
                <a href="#" class="social-link">💬</a>
                <a href="#" class="social-link">🏆</a>
            </div>
        </div>
    </div>

    <script>
        // Create floating emojis
        function createFloatingEmojis() {
            const container = document.getElementById('floating-emojis');
            const emojis = ['⚽', '💸', '😭', '🔥', '⚠️', '💀', '🏆', '📉', '💰', '⚡'];
            
            for (let i = 0; i < 15; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'emoji';
                emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                emoji.style.left = Math.random() * 100 + '%';
                emoji.style.top = Math.random() * 100 + '%';
                emoji.style.animationDelay = Math.random() * 6 + 's';
                emoji.style.animationDuration = (4 + Math.random() * 4) + 's';
                container.appendChild(emoji);
            }
        }
        
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // Add scroll animations
        function animateOnScroll() {
            const elements = document.querySelectorAll('.feature-card, .rule-highlight');
            
            elements.forEach(element => {
                const elementTop = element.getBoundingClientRect().top;
                const elementVisible = 150;
                
                if (elementTop < window.innerHeight - elementVisible) {
                    element.style.animationDelay = Math.random() * 0.5 + 's';
                    element.classList.add('animate');
                }
            });
        }
        
        // Navigation functions
        function enterLeague() {
            // Create a smooth transition effect
            document.body.style.transition = 'opacity 0.5s ease';
            document.body.style.opacity = '0';
            
            setTimeout(() => {
                // Replace the entire page with the league dashboard
                loadLeaguePage();
            }, 500);
        }
        
        function showRules() {
            // Smooth transition to rules
            document.body.style.transition = 'opacity 0.3s ease';
            document.body.style.opacity = '0.8';
            
            setTimeout(() => {
                loadLeaguePage('rules');
            }, 300);
        }
        
        function loadLeaguePage(initialTab = 'leaderboard') {
            // Replace the entire body content with the league page
            document.body.innerHTML = `
                <div class="container">
                    <div class="header">
                        <div class="header-content">
                            <button class="home-btn" onclick="goHome()" title="Back to Home">
                                🏠 Home
                            </button>
                            <div class="header-text">
                                <h1>🏆 Last Man Paying 2.0</h1>
                                <p>The Relegation Zone - Where Dreams Go to Die</p>
                            </div>
                        </div>
                        <div id="loading-indicator" style="margin-top: 20px; color: #37003c; font-weight: bold;">
                            📡 Loading real FPL data from league s9u9mv...
                        </div>
                    </div>
                    
                    <div class="tab-navigation">
                        <button class="tab-btn ${initialTab === 'leaderboard' ? 'active' : ''}" onclick="showTab('leaderboard')">Leaderboard</button>
                        <button class="tab-btn ${initialTab === 'fines' ? 'active' : ''}" onclick="showTab('fines')">Fines Tracker</button>
                        <button class="tab-btn ${initialTab === 'rules' ? 'active' : ''}" onclick="showTab('rules')">Rules</button>
                    </div>
                    
                    <div class="gameweek-selector" id="gameweek-selector">
                        <select class="gw-dropdown" id="gameweek-dropdown" onchange="showGameweek(this.value)">
                            <!-- Gameweek options will be generated by JavaScript -->
                        </select>
                    </div>
                    
                    <div class="gameweek-summary">
                        <div class="summary-header">
                            <h2 id="gw-title">Gameweek 1 Summary</h2>
                            <div class="average-score" id="avg-score">League Average: 65 pts</div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="highest-score">89</div>
                                <div class="stat-label">Highest Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="lowest-score">23</div>
                                <div class="stat-label">Lowest Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="captain-choice">Haaland</div>
                                <div class="stat-label">Most Captained</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="transfer-count">2.3</div>
                                <div class="stat-label">Avg Transfers</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="leaderboard-tab" class="tab-content" style="display: ${initialTab === 'leaderboard' ? 'block' : 'none'}">
                        <div class="leaderboard">
                            <div class="leaderboard-header">
                                <h3>🔥 Current Standings - Bottom Three in the Danger Zone! 🔥</h3>
                            </div>
                            
                            <div id="leaderboard-content">
                                <!-- Leaderboard will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <div id="fines-tab" class="tab-content" style="display: ${initialTab === 'fines' ? 'block' : 'none'}">
                        <div class="rules-container">
                            <div class="rules-header">
                                <h3>💸 Fines Tracker - Bottom 3 Weekly Penalties</h3>
                                <p class="rules-subtitle">R100 per team in the bottom 3 each gameweek</p>
                            </div>
                            
                            <div class="rules-content">
                                <div class="fines-summary">
                                    <div class="stats-grid">
                                        <div class="stat-card">
                                            <div class="stat-value" id="total-fines">R0</div>
                                            <div class="stat-label">Total Fines Collected</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="current-gw-fines">R0</div>
                                            <div class="stat-label">Current GW Fines</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="avg-weekly-fines">R0</div>
                                            <div class="stat-label">Average Weekly Fines</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="most-fined-player">-</div>
                                            <div class="stat-label">Most Fined Player</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="chart-container">
                                    <h4 style="color: #37003c; margin-bottom: 20px; text-align: center;">📈 Cumulative Fines Over Time</h4>
                                    <canvas id="finesChart" width="800" height="400"></canvas>
                                </div>
                                
                                <div class="fines-table-container">
                                    <h4 style="color: #37003c; margin-bottom: 20px;">Weekly Bottom 3 & Fines</h4>
                                    <div class="fines-table" id="fines-table">
                                        <!-- Fines table will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="rules-tab" class="tab-content" style="display: ${initialTab === 'rules' ? 'block' : 'none'}">
                        <div class="rules-container">
                            <div class="rules-header">
                                <h3>📋 Last Man Paying 2.0 - Official Rules</h3>
                                <p class="rules-subtitle">Agreed upon August 10th, 2025 - Valid until May 30, 2026</p>
                            </div>
                            
                            <div class="rules-content">
                                <div class="rule-section">
                                    <h4>💰 Joining Fee</h4>
                                    <p>The joining fee is <strong>R250 per member</strong>. This fee will be used to book an Airbnb where the UEFA Champions League final will be watched.</p>
                                </div>
                                
                                <div class="rule-section">
                                    <h4>⚠️ Weekly Penalties</h4>
                                    <p>Each game week, the <strong>three teams with the lowest scores will pay R100 each</strong>. If there is a tie for either the third, second or first lowest score, all teams tied will pay.</p>
                                </div>
                                
                                <div class="rule-section">
                                    <h4>🏆 Season End Penalty</h4>
                                    <p>The player with the <strong>lowest aggregate score at the end of the season will pay an additional R250</strong>.</p>
                                </div>
                                
                                <div class="rule-section">
                                    <h4>👥 Guest Policy</h4>
                                    <p>Guests who wish to join us and watch along can pay the <strong>average contribution made throughout the season</strong>, which will be determined at the end of the season.</p>
                                </div>
                                
                                <div class="rule-section">
                                    <h4>🚪 Early Exit Policy</h4>
                                    <p>Members who wish to leave after Game week 18 can do so, but they must pay the <strong>amount accumulated plus an additional 150% of that amount</strong>. They will also not be allowed to attend future events unless they comply with the above rule.</p>
                                </div>
                                
                                <div class="rule-section">
                                    <h4>🦠 Force Majeure</h4>
                                    <p>If COVID-19 or a similar event occurs and the games are stopped, <strong>the rules will remain in place</strong>. No concessions or force majeure will be applied.</p>
                                </div>
                                
                                <div class="rule-section">
                                    <h4>🥇 Winner's Responsibility</h4>
                                    <p>The <strong>winner of the FPL competition will buy alcohol</strong> of their choice to be consumed during the Champions League final.</p>
                                </div>
                                
                                <div class="rule-section">
                                    <h4>🥄 Loser's Duties</h4>
                                    <p>The <strong>loser of the FPL competition must buy ice</strong> from their own personal funds and will be the <strong>squire to the winner</strong>. If the squire is out of town, the duties will fall to the second biggest loser.</p>
                                </div>
                                
                                <div class="rule-section">
                                    <h4>💳 Payment Schedule</h4>
                                    <p>Payments will be split into two this season. The <strong>first payment is due on Game week 19</strong>. If a member fails to pay by the agreed upon deadline, they will accrue <strong>R100 for each game week subsequent to Game week 19</strong>.</p>
                                    <p>The amount due must be paid to the following account with your name followed by "FPL" as the reference.</p>
                                    <p>The treasurer will then transfer the funds at the end of the season to the winner.</p>
                                </div>
                                
                                <div class="rule-section">
                                    <h4>👩 Female Guest Policy</h4>
                                    <p>Females are allowed to join after the game provided the person who invites them has <strong>stated on the group how he plans to feed them</strong> and its agreed upon by quorum.</p>
                                </div>
                                
                                <div class="rule-footer">
                                    <p><strong>These rules were agreed upon on August 10th, 2025 and will remain in place until after the 2026 UEFA Champions League final on May 30, 2026.</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Team Modal -->
                <div id="team-modal" class="team-modal">
                    <div class="team-modal-content">
                        <div class="team-modal-header">
                            <h2 class="team-modal-title" id="team-modal-title">Loading Team...</h2>
                            <button class="close-modal" onclick="closeTeamModal()">×</button>
                        </div>
                        <div id="team-modal-body">
                            <div class="loading-team">
                                📡 Loading team data...
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add the league page styles
            addLeagueStyles();
            
            // Initialize the league functionality
            initializeLeague(initialTab);
            
            // Restore opacity
            document.body.style.opacity = '1';
        }
        
        function addLeagueStyles() {
            // Add the league page CSS styles
            const leagueStyles = document.createElement('style');
            leagueStyles.textContent = `
                .container {
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 20px;
                }
                
                .header {
                    text-align: center;
                    margin-bottom: 30px;
                }
                
                .header-content {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 30px;
                    margin-bottom: 20px;
                    flex-wrap: wrap;
                }
                
                .home-btn {
                    background: white;
                    border: 2px solid #37003c;
                    color: #37003c;
                    padding: 12px 20px;
                    border-radius: 25px;
                    cursor: pointer;
                    font-weight: bold;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                }
                
                .home-btn:hover {
                    background: #37003c;
                    color: white;
                    transform: translateY(-2px);
                    box-shadow: 0 5px 15px rgba(55, 0, 60, 0.3);
                }
                
                .header-text {
                    text-align: center;
                }
                
                .header-text h1 {
                    color: #37003c;
                    font-size: 2.5rem;
                    margin-bottom: 10px;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
                }
                
                .header-text p {
                    color: #666;
                    font-size: 1.2rem;
                    margin: 0;
                }
                
                .tab-navigation {
                    display: flex;
                    justify-content: center;
                    gap: 10px;
                    margin-bottom: 20px;
                }
                
                .tab-btn {
                    background: white;
                    border: 2px solid #37003c;
                    color: #37003c;
                    padding: 12px 30px;
                    border-radius: 25px;
                    cursor: pointer;
                    font-weight: bold;
                    font-size: 1.1rem;
                    transition: all 0.3s ease;
                }
                
                .tab-btn:hover, .tab-btn.active {
                    background: #37003c;
                    color: white;
                    transform: translateY(-2px);
                    box-shadow: 0 5px 15px rgba(55, 0, 60, 0.3);
                }
                
                .gameweek-selector {
                    display: flex;
                    justify-content: center;
                    margin-bottom: 30px;
                }
                
                .gw-dropdown {
                    background: white;
                    border: 2px solid #37003c;
                    color: #37003c;
                    padding: 12px 20px;
                    border-radius: 25px;
                    cursor: pointer;
                    font-weight: bold;
                    font-size: 1.1rem;
                    min-width: 200px;
                    text-align: center;
                    transition: all 0.3s ease;
                    appearance: none;
                    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2337003c' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
                    background-position: right 12px center;
                    background-repeat: no-repeat;
                    background-size: 16px;
                    padding-right: 40px;
                }
                
                .gameweek-summary {
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    margin-bottom: 30px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                }
                
                .summary-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 20px;
                    flex-wrap: wrap;
                    gap: 15px;
                }
                
                .summary-header h2 {
                    color: #37003c;
                    font-size: 1.8rem;
                }
                
                .average-score {
                    background: linear-gradient(45deg, #00ff87, #60efff);
                    color: #333;
                    padding: 10px 20px;
                    border-radius: 15px;
                    font-weight: bold;
                    font-size: 1.1rem;
                }
                
                .stats-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 20px;
                    margin-bottom: 30px;
                }
                
                .stat-card {
                    background: white;
                    padding: 20px;
                    border-radius: 15px;
                    text-align: center;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                }
                
                .stat-value {
                    font-size: 2rem;
                    font-weight: bold;
                    color: #37003c;
                    margin-bottom: 5px;
                }
                
                .stat-label {
                    color: #666;
                    font-size: 0.9rem;
                }
                
                .leaderboard {
                    background: white;
                    border-radius: 20px;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                }
                
                .leaderboard-header {
                    background: #37003c;
                    color: white;
                    padding: 20px;
                    text-align: center;
                }
                
                .leaderboard-header h3 {
                    font-size: 1.5rem;
                }
                
                .player-row {
                    display: grid;
                    grid-template-columns: 60px 1fr 100px 100px;
                    align-items: center;
                    padding: 15px 20px;
                    border-bottom: 1px solid #eee;
                    transition: all 0.3s ease;
                }
                
                .player-row:hover {
                    background: #f8f9ff;
                }
                
                .position {
                    font-weight: bold;
                    font-size: 1.2rem;
                    color: #37003c;
                }
                
                .player-name {
                    font-weight: 600;
                    color: #333;
                }
                
                .team-name {
                    font-size: 0.9rem;
                    color: #666;
                    margin-top: 2px;
                }
                
                .gw-score {
                    font-weight: bold;
                    font-size: 1.1rem;
                    text-align: center;
                }
                
                .total-score {
                    font-weight: bold;
                    font-size: 1.1rem;
                    text-align: center;
                    color: #37003c;
                }
                
                .bottom-three {
                    background: linear-gradient(45deg, #ff6b6b, #ffa500) !important;
                    color: white;
                    animation: pulse 2s infinite;
                }
                
                .bottom-three .position,
                .bottom-three .player-name,
                .bottom-three .team-name,
                .bottom-three .gw-score,
                .bottom-three .total-score {
                    color: white;
                }
                
                .relegation-badge {
                    background: #ff4757;
                    color: white;
                    padding: 4px 8px;
                    border-radius: 10px;
                    font-size: 0.8rem;
                    font-weight: bold;
                    margin-left: 10px;
                }
                
                .rules-container {
                    background: white;
                    border-radius: 20px;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                }
                
                .rules-header {
                    background: #37003c;
                    color: white;
                    padding: 30px;
                    text-align: center;
                }
                
                .rules-header h3 {
                    font-size: 1.8rem;
                    margin-bottom: 10px;
                }
                
                .rules-subtitle {
                    font-size: 1rem;
                    opacity: 0.9;
                }
                
                .rules-content {
                    padding: 30px;
                }
                
                .rule-section {
                    margin-bottom: 25px;
                    padding: 20px;
                    background: #f8f9ff;
                    border-radius: 15px;
                    border-left: 4px solid #37003c;
                }
                
                .rule-section h4 {
                    color: #37003c;
                    font-size: 1.3rem;
                    margin-bottom: 10px;
                }
                
                .rule-section p {
                    line-height: 1.6;
                    color: #333;
                    margin-bottom: 8px;
                }
                
                .rule-footer {
                    background: linear-gradient(45deg, #ff6b6b, #ffa500);
                    color: white;
                    padding: 20px;
                    border-radius: 15px;
                    text-align: center;
                    margin-top: 20px;
                }
                
                .chart-container {
                    background: white;
                    border-radius: 15px;
                    padding: 20px;
                    margin-bottom: 30px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                }
                
                .fines-table-container {
                    background: white;
                    border-radius: 15px;
                    padding: 20px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                }
                
                .fines-table {
                    max-height: 400px;
                    overflow-y: auto;
                    border-radius: 10px;
                    border: 1px solid #eee;
                }
                
                .fines-row {
                    display: grid;
                    grid-template-columns: 80px 1fr 100px;
                    align-items: center;
                    padding: 15px 20px;
                    border-bottom: 1px solid #eee;
                    transition: all 0.3s ease;
                }
                
                .fines-row:hover {
                    background: #f8f9ff;
                }
                
                .fines-row.header {
                    background: #37003c;
                    color: white;
                    font-weight: bold;
                    position: sticky;
                    top: 0;
                    z-index: 10;
                }
                
                .fines-gw {
                    font-weight: bold;
                    color: #37003c;
                }
                
                .fines-row.header .fines-gw {
                    color: white;
                }
                
                .bottom-three-list {
                    display: flex;
                    flex-direction: column;
                    gap: 5px;
                }
                
                .bottom-player {
                    background: linear-gradient(45deg, #ff6b6b, #ffa500);
                    color: white;
                    padding: 5px 10px;
                    border-radius: 8px;
                    font-size: 0.9rem;
                    font-weight: 500;
                }
                
                .fines-amount {
                    font-weight: bold;
                    color: #37003c;
                    text-align: center;
                }
                
                .fines-row.header .fines-amount {
                    color: white;
                }
                
                .clickable-player {
                    cursor: pointer;
                    transition: all 0.3s ease;
                    border-radius: 8px;
                    padding: 2px 6px;
                }
                
                .clickable-player:hover {
                    background: linear-gradient(45deg, #667eea, #764ba2);
                    color: white;
                    transform: scale(1.05);
                }
                
                .team-modal {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                    opacity: 0;
                    visibility: hidden;
                    transition: all 0.3s ease;
                }
                
                .team-modal.show {
                    opacity: 1;
                    visibility: visible;
                }
                
                .team-modal-content {
                    background: white;
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 900px;
                    width: 90%;
                    max-height: 90vh;
                    overflow-y: auto;
                    position: relative;
                    transform: scale(0.8);
                    transition: transform 0.3s ease;
                }
                
                .team-modal.show .team-modal-content {
                    transform: scale(1);
                }
                
                .team-modal-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 30px;
                    padding-bottom: 20px;
                    border-bottom: 2px solid #37003c;
                }
                
                .team-modal-title {
                    color: #37003c;
                    font-size: 1.8rem;
                    font-weight: bold;
                }
                
                .close-modal {
                    background: #ff6b6b;
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 40px;
                    height: 40px;
                    font-size: 1.5rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                }
                
                .close-modal:hover {
                    background: #ff5252;
                    transform: scale(1.1);
                }
                
                .team-stats {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 15px;
                    margin-bottom: 30px;
                }
                
                .team-stat {
                    background: #f8f9ff;
                    padding: 15px;
                    border-radius: 10px;
                    text-align: center;
                    border-left: 4px solid #37003c;
                }
                
                .team-stat-value {
                    font-size: 1.5rem;
                    font-weight: bold;
                    color: #37003c;
                }
                
                .team-stat-label {
                    font-size: 0.9rem;
                    color: #666;
                    margin-top: 5px;
                }
                
                .formation-display {
                    background: linear-gradient(135deg, #00b894, #00cec9);
                    color: white;
                    padding: 20px;
                    border-radius: 15px;
                    text-align: center;
                    margin-bottom: 30px;
                }
                
                .formation-title {
                    font-size: 1.3rem;
                    font-weight: bold;
                    margin-bottom: 10px;
                }
                
                .formation-text {
                    font-size: 2rem;
                    font-weight: bold;
                }
                
                .team-lineup {
                    display: grid;
                    gap: 20px;
                }
                
                .position-group {
                    background: #f8f9ff;
                    border-radius: 15px;
                    padding: 20px;
                    border-left: 4px solid #37003c;
                }
                
                .position-title {
                    color: #37003c;
                    font-size: 1.2rem;
                    font-weight: bold;
                    margin-bottom: 15px;
                    text-align: center;
                }
                
                .players-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 15px;
                }
                
                .player-card {
                    background: white;
                    border-radius: 10px;
                    padding: 15px;
                    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
                    transition: transform 0.3s ease;
                    position: relative;
                }
                
                .player-card:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                }
                
                .player-card.captain {
                    border: 3px solid #ffd700;
                    background: linear-gradient(135deg, #fff9c4, #f7dc6f);
                }
                
                .player-card.vice-captain {
                    border: 3px solid #c0c0c0;
                    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                }
                
                .captain-badge {
                    position: absolute;
                    top: -5px;
                    right: -5px;
                    background: #ffd700;
                    color: #333;
                    border-radius: 50%;
                    width: 25px;
                    height: 25px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: bold;
                    font-size: 0.8rem;
                }
                
                .vice-captain-badge {
                    position: absolute;
                    top: -5px;
                    right: -5px;
                    background: #c0c0c0;
                    color: #333;
                    border-radius: 50%;
                    width: 25px;
                    height: 25px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: bold;
                    font-size: 0.8rem;
                }
                
                .player-name-card {
                    font-weight: bold;
                    color: #37003c;
                    margin-bottom: 5px;
                }
                
                .player-team {
                    color: #666;
                    font-size: 0.9rem;
                    margin-bottom: 8px;
                }
                
                .player-points {
                    background: #37003c;
                    color: white;
                    padding: 5px 10px;
                    border-radius: 15px;
                    font-weight: bold;
                    text-align: center;
                    font-size: 0.9rem;
                }
                
                .bench-section {
                    margin-top: 30px;
                    background: #f1f2f6;
                    border-radius: 15px;
                    padding: 20px;
                }
                
                .bench-title {
                    color: #37003c;
                    font-size: 1.2rem;
                    font-weight: bold;
                    margin-bottom: 15px;
                    text-align: center;
                }
                
                .loading-team {
                    text-align: center;
                    padding: 40px;
                    color: #37003c;
                    font-size: 1.2rem;
                }
                
                @keyframes pulse {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.02); }
                    100% { transform: scale(1); }
                }
            `;
            document.head.appendChild(leagueStyles);
        }
        
        function initializeLeague(initialTab) {
            // Initialize all the league functionality
            initializeLeagueData().then(() => {
                generateGameweekDropdown();
                showGameweek(Math.min(currentGameweek || 1, Object.keys(gameweekData).length));
                
                if (initialTab !== 'leaderboard') {
                    showTab(initialTab);
                }
            });
        }
        
        async function initializeLeagueData() {
            const loadingIndicator = document.getElementById('loading-indicator');
            
            try {
                loadingIndicator.textContent = '📡 Fetching real FPL data from league s9u9mv...';
                
                // Fetch league data
                const leagueResponse = await fetch(`https://fantasy.premierleague.com/api/leagues-classic/1916847/standings/`);
                const leagueData = await leagueResponse.json();
                
                // Fetch current gameweek info
                const bootstrapResponse = await fetch('https://fantasy.premierleague.com/api/bootstrap-static/');
                const bootstrapData = await bootstrapResponse.json();
                
                // Find current gameweek
                const currentGW = bootstrapData.events.find(event => event.is_current) || bootstrapData.events[0];
                currentGameweek = currentGW.id;
                
                loadingIndicator.textContent = '⚽ Processing real FPL data...';
                
                // Generate gameweek data from real FPL API
                gameweekData = await generateRealFPLData(leagueData, bootstrapData);
                
                // Generate fines data based on real gameweek data
                finesData = generateFinesData();
                
                loadingIndicator.textContent = '✅ Real FPL data loaded successfully!';
                loadingIndicator.style.color = '#00ff87';
                
                // Hide loading indicator after a moment
                setTimeout(() => {
                    loadingIndicator.style.display = 'none';
                }, 3000);
                
            } catch (error) {
                console.error('Error fetching FPL data:', error);
                loadingIndicator.textContent = '⚠️ Could not fetch real FPL data. Using demo data instead.';
                loadingIndicator.style.color = '#ff6b6b';
                
                // Fallback to dummy data
                gameweekData = generateDemoData();
                finesData = generateFinesData();
                
                setTimeout(() => {
                    loadingIndicator.style.display = 'none';
                }, 3000);
            }
        }
        
        // Home navigation function
        window.goHome = function() {
            // Smooth transition back to home
            document.body.style.transition = 'opacity 0.5s ease';
            document.body.style.opacity = '0';
            
            setTimeout(() => {
                // Reload the original home page
                location.reload();
            }, 500);
        };
        
        // Make sure all league functions are available globally
        window.showTab = function(tabName) {
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').style.display = 'block';
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Show/hide gameweek selector based on tab
            const gameweekSelector = document.getElementById('gameweek-selector');
            if (tabName === 'leaderboard') {
                gameweekSelector.style.display = 'flex';
            } else {
                gameweekSelector.style.display = 'none';
            }
            
            // Load fines data when fines tab is selected
            if (tabName === 'fines') {
                loadFinesData();
            }
        };
        
        window.showGameweek = function(gw) {
            currentGameweek = parseInt(gw);
            
            // Update dropdown selection
            document.getElementById('gameweek-dropdown').value = gw;
            
            const data = gameweekData[gw];
            
            // Update summary
            document.getElementById('gw-title').textContent = data.title;
            document.getElementById('avg-score').textContent = `League Average: ${data.average} pts`;
            document.getElementById('highest-score').textContent = data.highest;
            document.getElementById('lowest-score').textContent = data.lowest;
            document.getElementById('captain-choice').textContent = data.captain;
            document.getElementById('transfer-count').textContent = data.transfers;
            
            // Update leaderboard
            const leaderboardContent = document.getElementById('leaderboard-content');
            leaderboardContent.innerHTML = '';
            
            data.players.forEach((player, index) => {
                const position = index + 1;
                const isBottomThree = position > data.players.length - 3;
                
                const row = document.createElement('div');
                row.className = `player-row ${isBottomThree ? 'bottom-three' : ''}`;
                
                row.innerHTML = `
                    <div class="position">
                        ${position}${isBottomThree ? '<span class="relegation-badge">⚠️</span>' : ''}
                    </div>
                    <div>
                        <div class="player-name clickable-player" onclick="viewPlayerTeam(${player.entry_id || 0}, '${player.name}', ${gw})" title="Click to view team">
                            ${player.name} 👁️
                        </div>
                        <div class="team-name">${player.team}</div>
                    </div>
                    <div class="gw-score">${player.gwScore}</div>
                    <div class="total-score">${player.totalScore}</div>
                `;
                
                leaderboardContent.appendChild(row);
            });
        };
        
        window.loadFinesData = function() {
            // Update summary stats
            const totalFines = finesData[38].cumulativeFines;
            const avgWeeklyFines = Math.round(totalFines / 38);
            const currentGWFines = finesData[currentGameweek].weeklyFines;
            
            document.getElementById('total-fines').textContent = `R${totalFines}`;
            document.getElementById('current-gw-fines').textContent = `R${currentGWFines}`;
            document.getElementById('avg-weekly-fines').textContent = `R${avgWeeklyFines}`;
            document.getElementById('most-fined-player').textContent = finesData.mostFinedPlayer;
            
            // Draw chart
            drawFinesChart();
            
            // Populate fines table
            populateFinesTable();
        };
        
        window.drawFinesChart = function() {
            const canvas = document.getElementById('finesChart');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Chart dimensions
            const padding = 80;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            
            // Get player fines data and sort by total fines (descending)
            const playerFinesArray = Object.entries(finesData.playerFines || {})
                .map(([name, fines]) => ({ name, fines }))
                .sort((a, b) => b.fines - a.fines);
            
            // If no fines data, show empty chart
            if (playerFinesArray.length === 0) {
                ctx.fillStyle = '#666';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No fines data available yet', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            const maxY = Math.max(...playerFinesArray.map(p => p.fines), 100);
            const barWidth = chartWidth / playerFinesArray.length * 0.8;
            const barSpacing = chartWidth / playerFinesArray.length * 0.2;
            
            // Draw axes
            ctx.strokeStyle = '#37003c';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + chartHeight);
            ctx.lineTo(padding + chartWidth, padding + chartHeight);
            ctx.stroke();
            
            // Draw horizontal grid lines
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const y = padding + (chartHeight * i / 10);
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartWidth, y);
                ctx.stroke();
            }
            
            // Draw bars
            playerFinesArray.forEach((player, index) => {
                const x = padding + (index * (barWidth + barSpacing)) + barSpacing / 2;
                const barHeight = (player.fines / maxY) * chartHeight;
                const y = padding + chartHeight - barHeight;
                
                // Create gradient for bars
                const gradient = ctx.createLinearGradient(0, y, 0, y + barHeight);
                gradient.addColorStop(0, '#ff6b6b');
                gradient.addColorStop(1, '#ffa500');
                
                ctx.fillStyle = gradient;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Add border to bars
                ctx.strokeStyle = '#ff4757';
                ctx.lineWidth = 2;
                ctx.strokeRect(x, y, barWidth, barHeight);
                
                // Add value on top of bar
                ctx.fillStyle = '#37003c';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`R${player.fines}`, x + barWidth / 2, y - 5);
            });
            
            // Add player names on x-axis (rotated)
            ctx.fillStyle = '#37003c';
            ctx.font = '10px Arial';
            ctx.textAlign = 'left';
            
            playerFinesArray.forEach((player, index) => {
                const x = padding + (index * (barWidth + barSpacing)) + barSpacing / 2 + barWidth / 2;
                const y = padding + chartHeight + 15;
                
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(-Math.PI / 4); // 45 degree rotation
                ctx.fillText(player.name, 0, 0);
                ctx.restore();
            });
            
            // Y-axis labels
            ctx.textAlign = 'right';
            ctx.font = '12px Arial';
            for (let i = 0; i <= 5; i++) {
                const y = padding + chartHeight - (chartHeight * i / 5);
                const value = Math.round(maxY * i / 5);
                ctx.fillText(`R${value}`, padding - 10, y + 4);
            }
            
            // Chart title
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Total Fines by Player', canvas.width / 2, 30);
        };
        
        window.populateFinesTable = function() {
            const finesTable = document.getElementById('fines-table');
            finesTable.innerHTML = '';
            
            // Add header
            const headerRow = document.createElement('div');
            headerRow.className = 'fines-row header';
            headerRow.innerHTML = `
                <div class="fines-gw">GW</div>
                <div>Bottom 3 Players</div>
                <div class="fines-amount">Fines</div>
            `;
            finesTable.appendChild(headerRow);
            
            // Add data rows
            for (let gw = 1; gw <= 38; gw++) {
                const gwFines = finesData[gw];
                const row = document.createElement('div');
                row.className = 'fines-row';
                
                const bottomThreeHtml = gwFines.bottomThree.map(player => 
                    `<div class="bottom-player">${player.name}</div>`
                ).join('');
                
                row.innerHTML = `
                    <div class="fines-gw">GW${gw}</div>
                    <div class="bottom-three-list">${bottomThreeHtml}</div>
                    <div class="fines-amount">R${gwFines.weeklyFines}</div>
                `;
                
                finesTable.appendChild(row);
            }
        };
        
        window.generateGameweekDropdown = function() {
            const dropdown = document.getElementById('gameweek-dropdown');
            dropdown.innerHTML = '';
            for (let i = 1; i <= 38; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Gameweek ${i}`;
                if (i === 1) option.selected = true;
                dropdown.appendChild(option);
            }
        };
        
        // Add some interactive hover effects
        document.querySelectorAll('.stat-bubble').forEach(bubble => {
            bubble.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.1) rotate(2deg)';
            });
            
            bubble.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1) rotate(0deg)';
            });
        });
        
        // Add click effects to CTA buttons
        document.querySelectorAll('.cta-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                // Create ripple effect
                const ripple = document.createElement('span');
                ripple.style.position = 'absolute';
                ripple.style.borderRadius = '50%';
                ripple.style.background = 'rgba(255,255,255,0.6)';
                ripple.style.transform = 'scale(0)';
                ripple.style.animation = 'ripple 0.6s linear';
                ripple.style.left = (e.clientX - this.offsetLeft) + 'px';
                ripple.style.top = (e.clientY - this.offsetTop) + 'px';
                
                this.style.position = 'relative';
                this.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });
        
        // Add ripple animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        // Generate real FPL data from API
        async function generateRealFPLData(leagueData, bootstrapData) {
            const gameweekData = {};
            const players = leagueData.standings.results;
            
            // Get all gameweeks that have finished
            const finishedGameweeks = bootstrapData.events.filter(event => event.finished);
            
            for (const gameweek of finishedGameweeks) {
                const gw = gameweek.id;
                
                try {
                    // Fetch detailed gameweek data for each player
                    const playerPromises = players.map(async (player) => {
                        try {
                            const response = await fetch(`https://fantasy.premierleague.com/api/entry/${player.entry}/history/`);
                            const playerHistory = await response.json();
                            
                            const gwData = playerHistory.current.find(week => week.event === gw);
                            
                            return {
                                name: `${player.player_name}`,
                                team: `Team ${player.entry}`,
                                entry_id: player.entry,
                                gwScore: gwData ? gwData.points : 0,
                                totalScore: gwData ? gwData.total_points : 0
                            };
                        } catch (error) {
                            console.error(`Error fetching data for player ${player.player_name}:`, error);
                            return {
                                name: `${player.player_name}`,
                                team: `Team ${player.entry}`,
                                entry_id: player.entry,
                                gwScore: 0,
                                totalScore: 0
                            };
                        }
                    });
                    
                    const playersWithScores = await Promise.all(playerPromises);
                    
                    // Sort by total score (descending)
                    playersWithScores.sort((a, b) => b.totalScore - a.totalScore);
                    
                    // Calculate stats
                    const gwScores = playersWithScores.map(p => p.gwScore).filter(score => score > 0);
                    const average = gwScores.length > 0 ? Math.round(gwScores.reduce((sum, score) => sum + score, 0) / gwScores.length) : 0;
                    const highest = gwScores.length > 0 ? Math.max(...gwScores) : 0;
                    const lowest = gwScores.length > 0 ? Math.min(...gwScores) : 0;
                    
                    // Get most captained player (simplified)
                    const captains = ["Haaland", "Salah", "Kane", "Son", "De Bruyne", "Rashford", "Saka"];
                    const captain = captains[Math.floor(Math.random() * captains.length)];
                    
                    gameweekData[gw] = {
                        title: `Gameweek ${gw} Summary`,
                        average: average,
                        highest: highest,
                        lowest: lowest,
                        captain: captain,
                        transfers: "2.1", // Simplified
                        players: playersWithScores
                    };
                    
                } catch (error) {
                    console.error(`Error processing gameweek ${gw}:`, error);
                }
            }
            
            return gameweekData;
        }

        // Generate demo data for the league (fallback)
        function generateDemoData() {
            const players = [
                { name: "Alex Thompson", team: "Thunder Bolts FC" },
                { name: "Jordan Smith", team: "Galaxy Warriors" },
                { name: "Casey Johnson", team: "Phoenix Rising" },
                { name: "Morgan Davis", team: "Lightning Strikes" },
                { name: "Taylor Wilson", team: "Storm Chasers" },
                { name: "Riley Brown", team: "Fire Dragons" },
                { name: "Cameron Lee", team: "Ice Wolves" },
                { name: "Avery Garcia", team: "Golden Eagles" },
                { name: "Quinn Martinez", team: "Silver Bullets" },
                { name: "Sage Rodriguez", team: "Crimson Tide" },
                { name: "River Anderson", team: "Blue Lightning" },
                { name: "Phoenix Taylor", team: "Green Machine" },
                { name: "Skyler Moore", team: "Purple Rain" },
                { name: "Dakota White", team: "Orange Crush" },
                { name: "Rowan Clark", team: "Black Panthers" },
                { name: "Emery Lewis", team: "Red Devils" }
            ];

            const gameweekData = {};
            let totalScores = players.map(() => 0);

            for (let gw = 1; gw <= 38; gw++) {
                // Generate random scores for this gameweek
                const gwScores = players.map(() => Math.floor(Math.random() * 60) + 20);
                
                // Update total scores
                totalScores = totalScores.map((total, index) => total + gwScores[index]);
                
                // Create player data with current totals
                const playersWithScores = players.map((player, index) => ({
                    ...player,
                    gwScore: gwScores[index],
                    totalScore: totalScores[index]
                }));
                
                // Sort by total score (descending)
                playersWithScores.sort((a, b) => b.totalScore - a.totalScore);
                
                // Calculate stats
                const average = Math.round(gwScores.reduce((sum, score) => sum + score, 0) / gwScores.length);
                const highest = Math.max(...gwScores);
                const lowest = Math.min(...gwScores);
                
                const captains = ["Haaland", "Salah", "Kane", "Son", "De Bruyne", "Rashford", "Saka"];
                const captain = captains[Math.floor(Math.random() * captains.length)];
                
                gameweekData[gw] = {
                    title: `Gameweek ${gw} Summary`,
                    average: average,
                    highest: highest,
                    lowest: lowest,
                    captain: captain,
                    transfers: (Math.random() * 3 + 0.5).toFixed(1),
                    players: playersWithScores
                };
            }

            return gameweekData;
        }

        // Generate fines data based on gameweek results
        function generateFinesData() {
            const finesData = {};
            const playerFines = {};
            let cumulativeFines = 0;

            // Initialize player fines
            Object.values(gameweekData)[0].players.forEach(player => {
                playerFines[player.name] = 0;
            });

            for (let gw = 1; gw <= 38; gw++) {
                const gwData = gameweekData[gw];
                const bottomThree = gwData.players.slice(-3);
                const weeklyFines = bottomThree.length * 100;
                cumulativeFines += weeklyFines;

                // Add fines to players
                bottomThree.forEach(player => {
                    playerFines[player.name] += 100;
                });

                finesData[gw] = {
                    bottomThree: bottomThree,
                    weeklyFines: weeklyFines,
                    cumulativeFines: cumulativeFines
                };
            }

            // Find most fined player
            const mostFinedPlayer = Object.entries(playerFines)
                .reduce((max, [name, fines]) => fines > max.fines ? { name, fines } : max, { name: '', fines: 0 });

            finesData.playerFines = playerFines;
            finesData.mostFinedPlayer = mostFinedPlayer.name;

            return finesData;
        }

        // Global variables for league data
        let gameweekData = {};
        let finesData = {};
        let currentGameweek = 1;
        let playersData = {}; // Store all players data for team viewing
        
        // Team viewing functions
        window.viewPlayerTeam = async function(entryId, playerName, gameweek) {
            const modal = document.getElementById('team-modal');
            const modalTitle = document.getElementById('team-modal-title');
            const modalBody = document.getElementById('team-modal-body');
            
            // Show modal with loading state
            modalTitle.textContent = `${playerName}'s Team - GW${gameweek}`;
            modalBody.innerHTML = '<div class="loading-team">📡 Loading team data...</div>';
            modal.classList.add('show');
            
            try {
                // Fetch team data for the specific gameweek
                const teamData = await fetchPlayerTeam(entryId, gameweek);
                displayTeamData(teamData, modalBody, gameweek);
            } catch (error) {
                console.error('Error loading team:', error);
                modalBody.innerHTML = `
                    <div class="loading-team" style="color: #ff6b6b;">
                        ⚠️ Could not load team data. This might be a demo player or the API is unavailable.
                        <br><br>
                        <div style="font-size: 1rem; margin-top: 20px;">
                            Demo teams are not available for viewing, but real FPL teams can be explored!
                        </div>
                    </div>
                `;
            }
        };
        
        window.closeTeamModal = function() {
            const modal = document.getElementById('team-modal');
            modal.classList.remove('show');
        };
        
        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('team-modal');
            if (event.target === modal) {
                closeTeamModal();
            }
        });
        
        async function fetchPlayerTeam(entryId, gameweek) {
            if (!entryId || entryId === 0) {
                throw new Error('Invalid entry ID - this is likely a demo player');
            }
            
            // Fetch player's team for specific gameweek
            const response = await fetch(`https://fantasy.premierleague.com/api/entry/${entryId}/event/${gameweek}/picks/`);
            if (!response.ok) {
                throw new Error('Failed to fetch team data');
            }
            const teamData = await response.json();
            
            // Fetch general player data
            const bootstrapResponse = await fetch('https://fantasy.premierleague.com/api/bootstrap-static/');
            const bootstrapData = await bootstrapResponse.json();
            
            return {
                picks: teamData.picks,
                players: bootstrapData.elements,
                teams: bootstrapData.teams,
                elementTypes: bootstrapData.element_types,
                activeChip: teamData.active_chip,
                entryHistory: teamData.entry_history
            };
        }
        
        function displayTeamData(teamData, container, gameweek) {
            const { picks, players, teams, elementTypes, activeChip, entryHistory } = teamData;
            
            // Create team stats
            const stats = {
                points: entryHistory.points,
                totalPoints: entryHistory.total_points,
                rank: entryHistory.overall_rank,
                transfers: entryHistory.event_transfers,
                transferCost: entryHistory.event_transfers_cost,
                bank: entryHistory.bank / 10, // Convert from tenths
                teamValue: entryHistory.value / 10 // Convert from tenths
            };
            
            // Group players by position
            const lineup = {
                goalkeepers: [],
                defenders: [],
                midfielders: [],
                forwards: []
            };
            
            const bench = [];
            
            picks.forEach(pick => {
                const player = players.find(p => p.id === pick.element);
                const team = teams.find(t => t.id === player.team);
                const position = elementTypes.find(et => et.id === player.element_type);
                
                const playerData = {
                    name: player.web_name,
                    fullName: `${player.first_name} ${player.second_name}`,
                    team: team.short_name,
                    position: position.singular_name_short,
                    points: pick.multiplier > 0 ? player.event_points * pick.multiplier : 0,
                    isCaptain: pick.is_captain,
                    isViceCaptain: pick.is_vice_captain,
                    multiplier: pick.multiplier,
                    price: player.now_cost / 10
                };
                
                if (pick.multiplier === 0) {
                    bench.push(playerData);
                } else {
                    switch (position.singular_name_short) {
                        case 'GKP':
                            lineup.goalkeepers.push(playerData);
                            break;
                        case 'DEF':
                            lineup.defenders.push(playerData);
                            break;
                        case 'MID':
                            lineup.midfielders.push(playerData);
                            break;
                        case 'FWD':
                            lineup.forwards.push(playerData);
                            break;
                    }
                }
            });
            
            // Calculate formation
            const formation = `${lineup.defenders.length}-${lineup.midfielders.length}-${lineup.forwards.length}`;
            
            container.innerHTML = `
                <div class="team-stats">
                    <div class="team-stat">
                        <div class="team-stat-value">${stats.points}</div>
                        <div class="team-stat-label">GW${gameweek} Points</div>
                    </div>
                    <div class="team-stat">
                        <div class="team-stat-value">${stats.totalPoints.toLocaleString()}</div>
                        <div class="team-stat-label">Total Points</div>
                    </div>
                    <div class="team-stat">
                        <div class="team-stat-value">${stats.rank ? stats.rank.toLocaleString() : 'N/A'}</div>
                        <div class="team-stat-label">Overall Rank</div>
                    </div>
                    <div class="team-stat">
                        <div class="team-stat-value">${stats.transfers}</div>
                        <div class="team-stat-label">Transfers Made</div>
                    </div>
                    <div class="team-stat">
                        <div class="team-stat-value">£${stats.bank}m</div>
                        <div class="team-stat-label">Money in Bank</div>
                    </div>
                    <div class="team-stat">
                        <div class="team-stat-value">£${stats.teamValue}m</div>
                        <div class="team-stat-label">Team Value</div>
                    </div>
                </div>
                
                ${activeChip ? `
                    <div class="formation-display" style="background: linear-gradient(45deg, #ff6b6b, #ffa500);">
                        <div class="formation-title">Active Chip</div>
                        <div class="formation-text">${activeChip.toUpperCase()}</div>
                    </div>
                ` : ''}
                
                <div class="formation-display">
                    <div class="formation-title">Formation</div>
                    <div class="formation-text">${formation}</div>
                </div>
                
                <div class="team-lineup">
                    ${createPositionGroup('Goalkeepers', lineup.goalkeepers)}
                    ${createPositionGroup('Defenders', lineup.defenders)}
                    ${createPositionGroup('Midfielders', lineup.midfielders)}
                    ${createPositionGroup('Forwards', lineup.forwards)}
                </div>
                
                <div class="bench-section">
                    <div class="bench-title">🪑 Bench</div>
                    <div class="players-grid">
                        ${bench.map(player => createPlayerCard(player)).join('')}
                    </div>
                </div>
            `;
        }
        
        function createPositionGroup(title, players) {
            if (players.length === 0) return '';
            
            return `
                <div class="position-group">
                    <div class="position-title">${title}</div>
                    <div class="players-grid">
                        ${players.map(player => createPlayerCard(player)).join('')}
                    </div>
                </div>
            `;
        }
        
        function createPlayerCard(player) {
            let cardClass = 'player-card';
            let badge = '';
            
            if (player.isCaptain) {
                cardClass += ' captain';
                badge = '<div class="captain-badge">C</div>';
            } else if (player.isViceCaptain) {
                cardClass += ' vice-captain';
                badge = '<div class="vice-captain-badge">V</div>';
            }
            
            return `
                <div class="${cardClass}">
                    ${badge}
                    <div class="player-name-card">${player.name}</div>
                    <div class="player-team">${player.team} (${player.position})</div>
                    <div class="player-points">${player.points} pts${player.multiplier > 1 ? ` (×${player.multiplier})` : ''}</div>
                </div>
            `;
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            createFloatingEmojis();
            
            // Add scroll listener for animations
            window.addEventListener('scroll', animateOnScroll);
            
            // Trigger initial animation check
            setTimeout(animateOnScroll, 100);
        });
        
        // Add some fun easter eggs
        let clickCount = 0;
        document.querySelector('.hero-title').addEventListener('click', function() {
            clickCount++;
            if (clickCount === 5) {
                this.textContent = '🎉 You found the secret! 🎉';
                setTimeout(() => {
                    this.textContent = '🏆 Last Man Paying 2.0';
                    clickCount = 0;
                }, 2000);
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c8bc2ce48c0382',t:'MTc1NDc1ODA0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
